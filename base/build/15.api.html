<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx学习笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="个人总结的vuepress学习技术文档-语法">
    <meta name="keywords" content="vuepress,最新技术文档,vuepress语法,markdown语法">
    
    <link rel="preload" href="/web-nginx/assets/css/0.styles.f55d81f7.css" as="style"><link rel="preload" href="/web-nginx/assets/js/app.a87aca4f.js" as="script"><link rel="preload" href="/web-nginx/assets/js/2.82475168.js" as="script"><link rel="preload" href="/web-nginx/assets/js/16.baa7b47c.js" as="script"><link rel="preload" href="/web-nginx/assets/js/5.bf72ff45.js" as="script"><link rel="prefetch" href="/web-nginx/assets/js/10.141eba88.js"><link rel="prefetch" href="/web-nginx/assets/js/11.eb52103c.js"><link rel="prefetch" href="/web-nginx/assets/js/12.10eb4d8d.js"><link rel="prefetch" href="/web-nginx/assets/js/13.eed0dfc2.js"><link rel="prefetch" href="/web-nginx/assets/js/14.ef6122fc.js"><link rel="prefetch" href="/web-nginx/assets/js/15.a917918c.js"><link rel="prefetch" href="/web-nginx/assets/js/17.4329a3f5.js"><link rel="prefetch" href="/web-nginx/assets/js/18.cb55b29c.js"><link rel="prefetch" href="/web-nginx/assets/js/19.d95cca11.js"><link rel="prefetch" href="/web-nginx/assets/js/20.7895150a.js"><link rel="prefetch" href="/web-nginx/assets/js/21.d644d2c8.js"><link rel="prefetch" href="/web-nginx/assets/js/22.57922214.js"><link rel="prefetch" href="/web-nginx/assets/js/23.10e0845a.js"><link rel="prefetch" href="/web-nginx/assets/js/24.ef9e772f.js"><link rel="prefetch" href="/web-nginx/assets/js/25.f6fa4dc3.js"><link rel="prefetch" href="/web-nginx/assets/js/26.1db73f7e.js"><link rel="prefetch" href="/web-nginx/assets/js/27.9a81b596.js"><link rel="prefetch" href="/web-nginx/assets/js/28.15380c9c.js"><link rel="prefetch" href="/web-nginx/assets/js/29.35eab9bf.js"><link rel="prefetch" href="/web-nginx/assets/js/3.972616e6.js"><link rel="prefetch" href="/web-nginx/assets/js/30.5a6c66e6.js"><link rel="prefetch" href="/web-nginx/assets/js/31.78cd2acc.js"><link rel="prefetch" href="/web-nginx/assets/js/32.71d47095.js"><link rel="prefetch" href="/web-nginx/assets/js/33.b0ae93c2.js"><link rel="prefetch" href="/web-nginx/assets/js/34.8dc142b9.js"><link rel="prefetch" href="/web-nginx/assets/js/35.3416f3e3.js"><link rel="prefetch" href="/web-nginx/assets/js/36.fd66eb2f.js"><link rel="prefetch" href="/web-nginx/assets/js/4.62d091b7.js"><link rel="prefetch" href="/web-nginx/assets/js/6.45ed1738.js"><link rel="prefetch" href="/web-nginx/assets/js/7.ad94f037.js"><link rel="prefetch" href="/web-nginx/assets/js/8.7e121a5b.js"><link rel="prefetch" href="/web-nginx/assets/js/9.7327400f.js">
    <link rel="stylesheet" href="/web-nginx/assets/css/0.styles.f55d81f7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/web-nginx/" class="home-link router-link-active"><!----> <span class="site-name">Nginx学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Nginx基础知识" class="dropdown-title"><span class="title">Nginx基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="Nginx基础知识" class="mobile-dropdown-title"><span class="title">Nginx基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-nginx/base/build/1.index.html" class="nav-link">
  1.Nginx基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Nginx高级知识" class="dropdown-title"><span class="title">Nginx高级知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="Nginx高级知识" class="mobile-dropdown-title"><span class="title">Nginx高级知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-nginx/senior/use/1.index.html" class="nav-link">
  1.Nginx精讲
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Nginx基础知识" class="dropdown-title"><span class="title">Nginx基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="Nginx基础知识" class="mobile-dropdown-title"><span class="title">Nginx基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-nginx/base/build/1.index.html" class="nav-link">
  1.Nginx基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Nginx高级知识" class="dropdown-title"><span class="title">Nginx高级知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="Nginx高级知识" class="mobile-dropdown-title"><span class="title">Nginx高级知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-nginx/senior/use/1.index.html" class="nav-link">
  1.Nginx精讲
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/web-nginx/base/build/1.index.html" class="sidebar-link">一.搭建 Nginx 运行环境</a></li><li><a href="/web-nginx/base/build/2.service.html" class="sidebar-link">二.配置静态资源服务</a></li><li><a href="/web-nginx/base/build/3.cdn.html" class="sidebar-link">三.配置CDN</a></li><li><a href="/web-nginx/base/build/4.cache.html" class="sidebar-link">四.配置浏览器缓存</a></li><li><a href="/web-nginx/base/build/5.cors.html" class="sidebar-link">五.配置跨域</a></li><li><a href="/web-nginx/base/build/6.link.html" class="sidebar-link">六.配置防盗链</a></li><li><a href="/web-nginx/base/build/7.module.html" class="sidebar-link">七.配置代理服务</a></li><li><a href="/web-nginx/base/build/8.project.html" class="sidebar-link">八.配置负载均衡</a></li><li><a href="/web-nginx/base/build/9.utils.html" class="sidebar-link">九.缓存</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>进程和线程</p> <h4 id="进程"><a href="#进程" class="header-anchor">#</a> 进程</h4> <p>进程<code>Process</code>是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础，进程是线程的容器。进程是资源分配的最小单位。我们启动一个服务，运行一个实列，就是开一个服务进程，Node.js里通过<code>node app.js</code>开启一个服务进程，多进程就是复制（fork）,fork出来的每个进程都拥有自己的独立空间地址、数据栈，一个进程无法访问另一个进程里定义的变量，数据结构，只有建立IPC通信，进程之间才可以共享数据。</p> <ul><li><p>Node.js中开启进程</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const http=require('http')
const server=http.createServer()
server.listen(3000,()=&gt;{
	process.title=&quot;123&quot;;
	console.log(process.pid)
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul> <h4 id="线程"><a href="#线程" class="header-anchor">#</a> 线程</h4> <p>线程是操作系统能够进行运算调度的最小单位，首先线程是属于进程的，一个进程可以有多个线程，但一个线程只能有一个进程。</p> <h5 id="单线程-一个进程只开一个线程"><a href="#单线程-一个进程只开一个线程" class="header-anchor">#</a> 单线程：一个进程只开一个线程</h5> <p>JavaScript就是属于单线程，程序按顺序执行（先不讨论异步），上面的执行完成后才能执行下面的，当使用单线程语言编码时切勿有过多耗时的同步操作，否则线程会造成阻塞，导致线程阻塞，所以进行编码时，尽可能使用异步操作。</p> <p>eg:同步任务耗时造成线程阻塞</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const http=require('http')
const longComputation=()=&gt;{
	let sum=0;
	for(let i=0;i&lt;1e10;i++){
		sum +=1
	}
	return sum
}
const server=http.createServer()
server.on('request',(req,res)=&gt;{
	if(req.url==='/compute'){
		console.log('start',new Date())
		const sum=lognComputation()
		console.log('end',new Date())
		return res.end(`Sum is ${sum}`)
	}else{
		res.end('Ok')
	}
})
server.listen(3000)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>当我们调用<code>/compute</code>的时候，如果想调用其他的路由地址比如<code>/</code>大约需要15s时间，也可以说一个用户请求完第一个<code>compute</code>接口后需要等待15秒，这对于用户来说是极其不友好的。</p> <p>单线程的一些说明</p> <ul><li><p>Node.js虽然是单线程模型，但是其基于事件驱动、异步非阻塞模式，可以应用于高并发场景，避免了线程创建、线程之间上下文切换所产生的资源开销。</p></li> <li><p>当你的项目中需要有大量计算，CPU耗时的操作的时候，要注意考虑开启多进程来完成</p></li> <li><p>Node.js开发过程中，错误会引起整个应用退出，应用的健壮性值得考验，尤其是错误的异常抛出，以及进程守护是必须做的。</p></li> <li><p>单线程无法利用多核CPU，但是后来Node.js提供的API以及一些第三方工具相应都得到解决。</p></li></ul> <h3 id="node-js中的进程与线程"><a href="#node-js中的进程与线程" class="header-anchor">#</a> Node.js中的进程与线程</h3> <p>Node.js是JavaScript在服务端的运行环境，构建在chrome的V8引擎之上，基于事件驱动、非阻塞I/O模型，充分利用操作系提供的异步I/O进行多任务的执行，适合于I/O密集型的应用场景，因为异步，程序无需阻塞等待结果返回，而是基于回调通知的机制，原本同步模式等待的时间，则可以用来处理其他任务。</p> <p>在Web服务器方面，著名的Nginx也是采用此模式（事件驱动），避免了多线程的线程创建，线程上下文切换的开销</p> <p>在单核CPU系统之上我们采用单进程+单线程的模式来开发。在多核CPU系统上，可以通过<code>child_process.fork</code>开启多个进程，即多进程+单线程模式。注意：开启多进程不是为了解决高并发，主要是解决了单进程模式下Node.js CPU利用率不足的情况，充分利用多核CPU的性能。</p> <h3 id="node-js中的进程"><a href="#node-js中的进程" class="header-anchor">#</a> Node.js中的进程</h3></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/3/13 下午6:33:19</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/web-nginx/assets/js/app.a87aca4f.js" defer></script><script src="/web-nginx/assets/js/2.82475168.js" defer></script><script src="/web-nginx/assets/js/16.baa7b47c.js" defer></script><script src="/web-nginx/assets/js/5.bf72ff45.js" defer></script>
  </body>
</html>
