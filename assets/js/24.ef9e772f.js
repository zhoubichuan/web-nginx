(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{510:function(s,a,t){"use strict";t.r(a);var e=t(20),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"九-缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#九-缓存"}},[s._v("#")]),s._v(" 九.缓存")]),s._v(" "),t("p",[s._v("nginx代理缓存")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n    proxy_cache_path /data/nginx/tmp-test "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("levels")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":2 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("keys_zone")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tmp-test:100m "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("inactive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("7d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max_size")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1000g"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("proxy_cache_path 缓存文件路径")]),s._v(" "),t("li",[s._v("levels 设置缓存文件目录层次；levels=1:2 表示两级目录")]),s._v(" "),t("li",[s._v("keys_zone 设置缓存名字和共享内存大小")]),s._v(" "),t("li",[s._v("inactive 在指定时间内没人访问则被删除")]),s._v(" "),t("li",[s._v("max_size 最大缓存空间，如果缓存空间满，默认覆盖掉缓存时间最长的资源。")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("location /tmp-test/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n  proxy_cache tmp-test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n  proxy_cache_valid  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("206")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("304")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("302")]),s._v(" 10d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n  proxy_cache_key "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n  proxy_set_header Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n  proxy_set_header X-Real-IP "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n  proxy_set_header   X-Forwarded-For "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n  proxy_pass http://127.0.0.1:8081/media_store.php/tmp-test/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ul",[t("li",[s._v("proxy_cache tmp-test 使用名为tmp-test的对应缓存配置")]),s._v(" "),t("li",[s._v("proxy_cache_valid 200 206 304 301 302 10d; 对httpcode为200…的缓存10天")]),s._v(" "),t("li",[s._v("proxy_cache_key $uri 定义缓存唯一key,通过唯一key来进行hash存取")]),s._v(" "),t("li",[s._v("proxy_set_header 自定义http header头，用于发送给后端真实服务器。")]),s._v(" "),t("li",[s._v("proxy_pass 指代理后转发的路径，注意是否需要最后的")])])])}),[],!1,null,null,null);a.default=n.exports}}]);