(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{761:function(s,a,t){"use strict";t.r(a);var e=t(3),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"九-缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#九-缓存"}},[s._v("#")]),s._v(" 九.缓存")]),s._v(" "),a("p",[s._v("nginx 代理缓存")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    proxy_cache_path /data/nginx/tmp-test "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("levels")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":2 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("keys_zone")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tmp-test:100m "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("inactive")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("7d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max_size")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1000g"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("proxy_cache_path 缓存文件路径")])]),s._v(" "),a("li",[a("p",[s._v("levels 设置缓存文件目录层次；levels=1:2 表示两级目录")])]),s._v(" "),a("li",[a("p",[s._v("keys_zone 设置缓存名字和共享内存大小")])]),s._v(" "),a("li",[a("p",[s._v("inactive 在指定时间内没人访问则被删除")])]),s._v(" "),a("li",[a("p",[s._v("max_size 最大缓存空间，如果缓存空间满，默认覆盖掉缓存时间最长的资源。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("location /tmp-test/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  proxy_cache tmp-test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  proxy_cache_valid  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("206")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("304")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("302")]),s._v(" 10d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  proxy_cache_key "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  proxy_set_header Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  proxy_set_header X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  proxy_set_header   X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  proxy_pass http://127.0.0.1:8081/media_store.php/tmp-test/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("proxy_cache tmp-test 使用名为 tmp-test 的对应缓存配置")])]),s._v(" "),a("li",[a("p",[s._v("proxy_cache_valid 200 206 304 301 302 10d; 对 httpcode 为 200…的缓存 10 天")])]),s._v(" "),a("li",[a("p",[s._v("proxy_cache_key $uri 定义缓存唯一 key,通过唯一 key 来进行 hash 存取")])]),s._v(" "),a("li",[a("p",[s._v("proxy_set_header 自定义 http header 头，用于发送给后端真实服务器。")])]),s._v(" "),a("li",[a("p",[s._v("proxy_pass 指代理后转发的路径，注意是否需要最后的")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);